# Data Model: Backend Todo API

**Feature**: Backend Todo API
**Date**: 2025-12-28
**Purpose**: Define entities, fields, validation rules, and state transitions

## Overview

The Backend Todo API operates on a single entity: **Todo**. This entity represents a task item with description, completion status, and metadata. The data model is designed for simplicity with in-memory storage and no relationships to other entities.

## Entity: Todo

### Description
A Todo represents a single task or action item that a user wants to track. Each todo has a unique identifier, descriptive text, completion status, and timestamps for creation and modification tracking.

### Fields

| Field | Type | Constraints | Default | Description |
|-------|------|-------------|---------|-------------|
| `id` | integer | Required, Unique, Read-only, Auto-generated | Auto-increment from 1 | Unique identifier for the todo |
| `description` | string | Required, 1-500 characters | None | Task description or title |
| `completed` | boolean | Required | `false` | Whether the task is completed |
| `created_at` | datetime | Required, Read-only, Auto-generated | `datetime.utcnow()` | UTC timestamp when todo was created |
| `updated_at` | datetime | Required, Read-only, Auto-updated | `datetime.utcnow()` | UTC timestamp when todo was last modified |

### Field Details

#### id (integer)
- **Purpose**: Uniquely identifies each todo
- **Generation**: Auto-increment counter starting from 1
- **Immutability**: Cannot be changed after creation
- **Uniqueness**: Guaranteed unique across all todos
- **Format**: Positive integer (1, 2, 3, ...)

#### description (string)
- **Purpose**: Human-readable task description
- **Validation**:
  - Minimum length: 1 character (non-empty)
  - Maximum length: 500 characters
  - No special character restrictions
- **Mutability**: Can be updated via PATCH endpoint
- **Encoding**: UTF-8

#### completed (boolean)
- **Purpose**: Tracks whether task is done
- **Values**: `true` or `false`
- **Default**: `false` (new todos are incomplete)
- **Mutability**: Can be toggled via PATCH endpoint
- **State Meaning**:
  - `false`: Task is pending or in progress
  - `true`: Task is finished

#### created_at (datetime)
- **Purpose**: Records when todo was created
- **Format**: ISO 8601 string (e.g., "2025-12-28T10:30:00.123456")
- **Timezone**: UTC (no timezone offset)
- **Generation**: Auto-populated on creation using `datetime.utcnow()`
- **Immutability**: Never changes after creation
- **Precision**: Microseconds

#### updated_at (datetime)
- **Purpose**: Records when todo was last modified
- **Format**: ISO 8601 string (e.g., "2025-12-28T10:30:45.789012")
- **Timezone**: UTC (no timezone offset)
- **Generation**: Auto-updated on any modification (description or completed changes)
- **Initial Value**: Same as created_at on creation
- **Precision**: Microseconds

## Validation Rules

### Required Fields
- `description`: Must be provided on creation
- `id`, `completed`, `created_at`, `updated_at`: Auto-generated by system

### Constraints

**Description Constraints**:
- `min_length`: 1 (cannot be empty string)
- `max_length`: 500 (truncated or rejected if longer)
- Must be non-null

**Completed Constraints**:
- Must be boolean type (`true` or `false`)
- String values like "true" or "false" are converted by Pydantic

**ID Constraints**:
- Must be positive integer
- Must be unique (enforced by counter logic)
- Cannot be 0 or negative

**Timestamp Constraints**:
- Must be valid datetime
- Must be in ISO 8601 format
- Must be in UTC timezone

### Validation Error Responses

| Violation | HTTP Status | Error Message |
|-----------|-------------|---------------|
| Empty description | 400 Bad Request | "description must not be empty" or Pydantic validation error |
| Description > 500 chars | 400 Bad Request | "description must not exceed 500 characters" or Pydantic validation error |
| Invalid completed value | 400 Bad Request | "completed must be boolean" or Pydantic validation error |
| Missing required field | 400 Bad Request | Pydantic validation error with field name |

## State Transitions

### Creation Flow
```
[No Todo] --POST /api/todos--> [Todo: completed=false]
```

**Trigger**: POST request to `/api/todos` with description
**Initial State**: Todo does not exist
**Final State**: New todo created with:
- Auto-generated `id`
- Provided `description`
- `completed` = `false`
- `created_at` = current UTC time
- `updated_at` = current UTC time (same as created_at)

### Update Flow
```
[Todo: completed=false] --PATCH--> [Todo: completed=true]
[Todo: description="Old"] --PATCH--> [Todo: description="New", updated_at refreshed]
```

**Trigger**: PATCH request to `/api/todos/{id}` with partial data
**Allowed Transitions**:
- `completed`: `false` → `true` or `true` → `false`
- `description`: Any valid string → Any other valid string
- `updated_at`: Always updated to current UTC time

**Constraints**:
- Cannot modify `id` (read-only)
- Cannot modify `created_at` (read-only)
- At least one field (description or completed) must be provided

### Deletion Flow
```
[Todo exists] --DELETE--> [Todo removed from storage]
```

**Trigger**: DELETE request to `/api/todos/{id}`
**Initial State**: Todo exists in storage
**Final State**: Todo completely removed (no soft delete)
**Result**: Subsequent GET/PATCH/DELETE return 404

## Relationships

**None** - This is a single-entity system with no relationships to other entities.

Future phases may introduce:
- User entity (one user has many todos)
- Category/Tag entities (many-to-many with todos)
- Attachment entity (one todo has many attachments)

## Storage Representation

### In-Memory Storage (Current Phase)
```python
todos: List[Dict] = [
    {
        "id": 1,
        "description": "Buy groceries",
        "completed": False,
        "created_at": "2025-12-28T10:00:00.123456",
        "updated_at": "2025-12-28T10:00:00.123456"
    },
    {
        "id": 2,
        "description": "Write documentation",
        "completed": True,
        "created_at": "2025-12-28T11:00:00.789012",
        "updated_at": "2025-12-28T11:30:00.456789"
    }
]
```

### Future Database Schema (Planned)
```sql
CREATE TABLE todos (
    id SERIAL PRIMARY KEY,
    description VARCHAR(500) NOT NULL CHECK (length(description) > 0),
    completed BOOLEAN NOT NULL DEFAULT FALSE,
    created_at TIMESTAMP NOT NULL DEFAULT (NOW() AT TIME ZONE 'UTC'),
    updated_at TIMESTAMP NOT NULL DEFAULT (NOW() AT TIME ZONE 'UTC')
);

CREATE INDEX idx_todos_completed ON todos(completed);
```

## Pydantic Models

### TodoCreate (Request Model)
```python
class TodoCreate(BaseModel):
    description: str = Field(..., min_length=1, max_length=500)
```

**Purpose**: Validate incoming POST requests for todo creation
**Fields**: Only `description` (system generates others)
**Validation**: Pydantic enforces min/max length

### TodoUpdate (Request Model)
```python
class TodoUpdate(BaseModel):
    description: Optional[str] = Field(None, min_length=1, max_length=500)
    completed: Optional[bool] = None
```

**Purpose**: Validate incoming PATCH requests for todo updates
**Fields**: Optional `description` and/or `completed` (partial updates allowed)
**Validation**: Only validates if field is provided

### TodoResponse (Response Model)
```python
class TodoResponse(BaseModel):
    id: int
    description: str
    completed: bool
    created_at: datetime
    updated_at: datetime
```

**Purpose**: Serialize todo data for API responses
**Fields**: All todo fields
**Conversion**: Pydantic auto-converts ISO datetime strings to datetime objects

## Business Rules

1. **Uniqueness**: Each todo must have a unique ID
2. **Immutability**: IDs and created_at timestamps cannot be changed
3. **Auto-Update**: updated_at must be refreshed on any modification
4. **Default State**: New todos default to `completed=false`
5. **Validation**: Empty descriptions are rejected
6. **Length Limit**: Descriptions cannot exceed 500 characters
7. **Persistence**: Data persists in-memory during server runtime
8. **Data Loss**: All todos lost on server restart (acceptable for this phase)

## Example Data Lifecycle

### 1. Create Todo
**Request**: `POST /api/todos`
```json
{
  "description": "Buy groceries"
}
```

**Response**: `201 Created`
```json
{
  "id": 1,
  "description": "Buy groceries",
  "completed": false,
  "created_at": "2025-12-28T10:00:00.123456",
  "updated_at": "2025-12-28T10:00:00.123456"
}
```

### 2. Update Todo (Mark Complete)
**Request**: `PATCH /api/todos/1`
```json
{
  "completed": true
}
```

**Response**: `200 OK`
```json
{
  "id": 1,
  "description": "Buy groceries",
  "completed": true,
  "created_at": "2025-12-28T10:00:00.123456",
  "updated_at": "2025-12-28T10:05:00.789012"
}
```

### 3. Update Todo (Change Description)
**Request**: `PATCH /api/todos/1`
```json
{
  "description": "Buy groceries and milk"
}
```

**Response**: `200 OK`
```json
{
  "id": 1,
  "description": "Buy groceries and milk",
  "completed": true,
  "created_at": "2025-12-28T10:00:00.123456",
  "updated_at": "2025-12-28T10:10:00.456789"
}
```

### 4. Delete Todo
**Request**: `DELETE /api/todos/1`
**Response**: `204 No Content` (no body)

**Subsequent GET**: `GET /api/todos/1`
**Response**: `404 Not Found`
```json
{
  "detail": "Todo 1 not found"
}
```

## Data Model Validation

- ✅ All fields defined with types and constraints
- ✅ Validation rules specified
- ✅ State transitions documented
- ✅ Pydantic models provided
- ✅ Business rules enumerated
- ✅ Example lifecycle demonstrated
- ✅ No relationships (single entity)
- ✅ Storage representation shown

**Data Model Status**: ✅ COMPLETE
